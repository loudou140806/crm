<!doctype html><html lang="en"><head><meta charset="UTF-8"><title>Document</title><link rel="stylesheet" href="//loumingjie.cn/crm/build/libs/umeditor/third-party/mathquill/mathquill.css"><style>.main,body,html{margin:0;padding:0;overflow:hidden}.main{width:1024px;height:1024px}.mathquill-editable,.mathquill-rendered-math{border:0;padding:0;margin:4px}</style></head><body><div class="main"><div class="mathquill-editable"></div></div><div><input id="blurHelper"></div><script charset="utf-8" src="//loumingjie.cn/crm/build/libs/umeditor/third-party/jquery.min.js"></script><script charset="utf-8" src="//loumingjie.cn/crm/build/libs/umeditor/third-party/mathquill/mathquill.js"></script><script>$(function(){function t(){var t=parent.document.getElementsByTagName("iframe");for(var e in t)if(t[e].contentWindow==window)return t[e];return null}function e(){return l.attr("data-latex")||""}function i(){s&&clearTimeout(s),s=setTimeout(function(){o.fireEvent("savescene"),o.fireEvent("contentchange"),o.fireEvent("selectionchange"),s=null},300)}function a(){"false"==o.body.contentEditable&&o.setEnabled()}function n(){"true"==o.body.contentEditable&&o.setDisabled(["undo","redo","preview","formula"],!0)}var s,u=parent.UM,l=$(t()),r=l.parents(".edui-body-container").attr("id"),o=u.getEditor(r),h=function(){var t=this,i=e();this.isFocus=!1,this.isDisabled=!1,this.$mathquill=$(".mathquill-editable").mathquill("latex",i),this.$mathquill.on("mousedown",function(){return!t.disabled&&(l.hasClass("edui-formula-active")||(n(),o.blur(),o.$body.find("iframe").not(l).each(function(t,e){e.contentWindow.formula.blur()}),"none"==t.$mathquill.find(".cursor").css("display")&&(t.refresh(),t.$mathquill.addClass("hasCursor"))),void t.focus())}),o.addListener("click",function(){t.blur(),a()}),o.addListener("isFocus",function(){return t.isFocus}),o.addListener("setDisabled",function(e,i){i&&i.join(" ").indexOf("formula")!=-1||1==t.isDisabled||t.setDisabled()}),o.addListener("setEnabled",function(){0!=t.isDisabled&&t.setEnabled()}),$(document.body).on("keydown",function(){t.updateIframe()}).on("keyup",function(){t.updateIframe()}),this.$mathquill.removeClass("hasCursor"),setTimeout(function(){t.updateIframe()},300)};h.prototype={focus:function(){l.addClass("edui-formula-active"),this.isFocus=!0},blur:function(){l.removeClass("edui-formula-active"),this.removeCursor(),this.isFocus=!1},removeCursor:function(){this.$mathquill.find("span.cursor").hide(),this.$mathquill.parent().find(".hasCursor").removeClass("hasCursor")},updateIframe:function(){l.width(this.$mathquill.width()+8).height(this.$mathquill.height()+8);var t=l.attr("data-latex"),e=this.getLatex();t!=e&&(l.attr("data-latex",this.getLatex()),i())},insertLatex:function(t){this.$mathquill.mathquill("write",t),this.updateIframe(),this.removeCursor()},setLatex:function(t){this.$mathquill.mathquill("latex",t),this.updateIframe()},getLatex:function(){return this.$mathquill.mathquill("latex")},redraw:function(){this.$mathquill.mathquill("redraw")},setDisabled:function(){this.blur();var t=this.getLatex();this.$mathquill.mathquill("revert").text(t).mathquill(),this.updateIframe(),this.isDisabled=!0},setEnabled:function(){this.$mathquill.removeClass("mathquill-rendered-math"),this.refresh(),this.isDisabled=!1},refresh:function(){var t=this.getLatex();this.$mathquill.mathquill("revert").text(t).mathquill("editable"),this.updateIframe()}},window.formula=new h})</script></body></html>