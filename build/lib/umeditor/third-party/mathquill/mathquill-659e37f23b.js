!function(){function t(){}function e(t){var e=f.call(arguments,1);return function(){return t.apply(this,e)}}function n(t,e){if(!e)throw new Error("prayer failed: "+t)}function i(t){n("a direction was passed",t===v||t===b)}function r(e,n,i,r){function s(){l=a;var t=h.selection?"$"+h.selection.latex()+"$":"";j.select(t)}function o(){p.detach()}var c=e.contents().detach();i||e.addClass("mathquill-rendered-math"),n.jQ=e.attr(u,n.id),n.revert=function(){e.empty().unbind(".mathquill").removeClass("mathquill-rendered-math mathquill-editable mathquill-textbox").append(c)};var h=n.cursor=ct(n);n.renderLatex(c.text());var l,p=n.textarea=w('<span class="textarea"><textarea></textarea></span>'),f=p.children();n.selectionChanged=function(){l===a&&(l=setTimeout(s)),T(e[0])},e.bind("selectstart.mathquill",function(t){t.target!==f[0]&&t.preventDefault(),t.stopPropagation()});var d,g=h.blink;if(e.bind("mousedown.mathquill",function(n){function i(t){return h.seek(w(t.target),t.pageX,t.pageY),h[v]===d[v]&&h.parent===d.parent||h.selectFrom(d),!1}function s(t){return delete t.target,i(t)}function o(t){d=a,h.blink=g,h.selection||(r?h.show():p.detach()),e.unbind("mousemove",i),w(t.target.ownerDocument).unbind("mousemove",s).unbind("mouseup",o)}return setTimeout(function(){f.focus()}),h.blink=t,h.seek(w(n.target),n.pageX,n.pageY),d=x(h.parent,h[v],h[b]),r||e.prepend(p),e.mousemove(i),w(n.target.ownerDocument).mousemove(s).mouseup(o),!1}),!r){var j=m(f,{container:e});return e.bind("cut paste",!1).bind("copy",s).prepend('<span class="selectable">$'+n.latex()+"$</span>"),void f.blur(function(){h.clearSelection(),setTimeout(o)})}var j=m(f,{container:e,key:function(t,e){h.parent.bubble("onKey",t,e)},text:function(t){h.parent.bubble("onText",t)},cut:function(t){h.selection&&setTimeout(function(){h.prepareEdit(),h.parent.bubble("redraw")}),t.stopPropagation()},paste:function(t){t="$"===t.slice(0,1)&&"$"===t.slice(-1)?t.slice(1,-1):"\\text{"+t+"}",h.writeLatex(t).show()}});e.prepend(p),e.addClass("mathquill-editable"),i&&e.addClass("mathquill-textbox"),f.focus(function(t){h.parent||h.insAtRightEnd(n),h.parent.jQ.addClass("hasCursor"),h.selection?(h.selection.jQ.removeClass("blur"),setTimeout(n.selectionChanged)):h.show(),t.stopPropagation()}).blur(function(t){h.hide().parent.blur(),h.selection&&h.selection.jQ.addClass("blur"),t.stopPropagation()}),e.bind("focus.mathquill blur.mathquill",function(t){f.trigger(t)}).blur()}function s(t,e,n){return d(Z,{ctrlSeq:t,htmlTemplate:"<"+e+" "+n+">&0</"+e+">"})}var a,o,c,h=window.jQuery,l="mathquill-command-id",u="mathquill-block-id",p=Math.min,f=(Math.max,[].slice),d=function(t,e,n){function i(t){return"object"==typeof t}function r(t){return"function"==typeof t}function s(){}function a(o,c){function h(){var t=new l;return r(t.init)&&t.init.apply(t,arguments),t}function l(){}c===n&&(c=o,o=Object),h.Bare=l;var u,p=s[t]=o[t],f=l[t]=h[t]=new s;return f.constructor=h,h.mixin=function(e){return l[t]=h[t]=a(h,e)[t],h},(h.open=function(t){if(u={},r(t)?u=t.call(h,f,p,h,o):i(t)&&(u=t),i(u))for(var n in u)e.call(u,n)&&(f[n]=u[n]);return r(f.init)||(f.init=o),h})(c)}return a}("prototype",{}.hasOwnProperty),m=function(){function e(t){var e,i=t.which||t.keyCode,r=n[i],s=[];return t.ctrlKey&&s.push("Ctrl"),t.originalEvent&&t.originalEvent.metaKey&&s.push("Meta"),t.altKey&&s.push("Alt"),t.shiftKey&&s.push("Shift"),e=r||String.fromCharCode(i),s.length||r?(s.push(e),s.join("-")):e}var n={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(n,i){function r(t){Q=t,clearTimeout(b),b=setTimeout(t)}function s(e){Q(),Q=t,clearTimeout(b),q.val(e),e&&q[0].select()}function a(){var t=q[0];return"selectionStart"in t&&t.selectionStart!==t.selectionEnd}function o(t){var e=q.val();q.val(""),e&&t(e)}function c(){x(e(g),g)}function l(t){g=t,v=null,c()}function u(t){g&&v&&c(),v=t,r(p)}function p(){a()||o(w)}function f(){g=v=null}function d(t){q.focus(),r(m)}function m(){o(j)}var g=null,v=null;i||(i={});var b,w=i.text||t,x=i.key||t,j=i.paste||t,k=i.cut||t,q=h(n),y=h(i.container||q),Q=t;return y.bind("keydown keypress input keyup focusout paste",function(){Q()}),y.bind({keydown:l,keypress:u,focusout:f,cut:k,paste:d}),{select:s}}}(),g=d(function(t,e,i){function r(t,e){throw t=t?"'"+t+"'":"EOF","Parse Error: "+e+" at "+t}t.init=function(t){this._=t},t.parse=function(t){function e(t,e){return e}return this.skip(o)._(t,e,r)},t.or=function(t){n("or is passed a parser",t instanceof i);var e=this;return i(function(n,i,r){function s(e){return t._(n,i,r)}return e._(n,i,s)})},t.then=function(t){var e=this;return i(function(r,s,a){function o(e,r){var o=t instanceof i?t:t(r);return n("a parser is returned",o instanceof i),o._(e,s,a)}return e._(r,o,a)})},t.many=function(){var t=this;return i(function(e,n,i){function r(t,n){return e=t,a.push(n),!0}function s(){return!1}for(var a=[];t._(e,r,s););return n(e,a)})},t.times=function(t,e){arguments.length<2&&(e=t);var n=this;return i(function(i,r,s){function a(t,e){return l.push(e),i=t,!0}function o(t,e){return h=e,i=t,!1}function c(t,e){return!1}for(var h,l=[],u=!0,p=0;p<t;p+=1)if(u=n._(i,a,o),!u)return s(i,h);for(;p<e&&u;p+=1)u=n._(i,a,c);return r(i,l)})},t.result=function(t){return this.then(a(t))},t.atMost=function(t){return this.times(0,t)},t.atLeast=function(t){var e=this;return e.times(t).then(function(t){return e.many().map(function(e){return t.concat(e)})})},t.map=function(t){return this.then(function(e){return a(t(e))})},t.skip=function(t){return this.then(function(e){return t.result(e)})};var s=(this.string=function(t){var e=t.length,n="expected '"+t+"'";return i(function(i,r,s){var a=i.slice(0,e);return a===t?r(i.slice(e),a):s(i,n)})},this.regex=function(t){n("regexp parser is anchored","^"===t.toString().charAt(1));var e="expected "+t;return i(function(n,i,r){var s=t.exec(n);if(s){var a=s[0];return i(n.slice(a.length),a)}return r(n,e)})}),a=i.succeed=function(t){return i(function(e,n){return n(e,t)})},o=(i.fail=function(t){return i(function(e,n,i){return i(e,t)})},i.letter=s(/^[a-z]/i),i.letters=s(/^[a-z]*/i),i.digit=s(/^[0-9]/),i.digits=s(/^[0-9]*/),i.whitespace=s(/^\s+/),i.optWhitespace=s(/^\s*/),i.any=i(function(t,e,n){return t?e(t.slice(1),t.charAt(0)):n(t,"expected any character")}),i.all=i(function(t,e,n){return e("",t)}),i.eof=i(function(t,e,n){return t?n(t,"expected EOF"):e(t,t)}))}),v=-1,b=1,w=d(h,function(t){t.insDirOf=function(t,e){return t===v?this.insertBefore(e.first()):this.insertAfter(e.last())},t.insAtDirEnd=function(t,e){return t===v?this.prependTo(e):this.appendTo(e)}}),x=d(function(t){t.parent=0,t[v]=0,t[b]=0,t.init=function(t,e,n){this.parent=t,this[v]=e,this[b]=n}}),j=d(function(t){t[v]=0,t[b]=0,t.parent=0,t.init=function(){this.ends={},this.ends[v]=0,this.ends[b]=0},t.children=function(){return k(this.ends[v],this.ends[b])},t.eachChild=function(t){return this.children().each(t)},t.foldChildren=function(t,e){return this.children().fold(t,e)},t.adopt=function(t,e,n){return k(this,this).adopt(t,e,n),this},t.disown=function(){return k(this,this).disown(),this}}),k=d(function(t){function e(t,e,i){n("a parent is always present",t),n("leftward is properly set up",function(){return e?e[b]===i&&e.parent===t:t.ends[v]===i}()),n("rightward is properly set up",function(){return i?i[v]===e&&i.parent===t:t.ends[b]===e}())}t.init=function(t,e){n("no half-empty fragments",!t==!e),this.ends={},t&&(n("left end node is passed to Fragment",t instanceof j),n("right end node is passed to Fragment",e instanceof j),n("leftEnd and rightEnd have the same parent",t.parent===e.parent),this.ends[v]=t,this.ends[b]=e)},t.adopt=function(t,n,i){e(t,n,i);var r=this;r.disowned=!1;var s=r.ends[v];if(!s)return this;var a=r.ends[b];return n||(t.ends[v]=s),i?i[v]=a:t.ends[b]=a,r.ends[b][b]=i,r.each(function(e){e[v]=n,e.parent=t,n&&(n[b]=e),n=e}),r},t.disown=function(){var t=this,n=t.ends[v];if(!n||t.disowned)return t;t.disowned=!0;var i=t.ends[b],r=n.parent;return e(r,n[v],n),e(r,i,i[b]),n[v]?n[v][b]=i[b]:r.ends[v]=i[b],i[b]?i[b][v]=n[v]:r.ends[b]=n[v],t},t.each=function(t){var e=this,n=e.ends[v];if(!n)return e;for(;n!==e.ends[b][b]&&t.call(e,n)!==!1;n=n[b]);return e},t.fold=function(t,e){return this.each(function(n){t=e.call(this,t,n)}),t}}),q=function(){var t=0;return function(){return t+=1}}(),y=d(j,function(t,e){t.init=function(t){e.init.call(this),this.id=q(),y[this.id]=this},t.toString=function(){return"[MathElement "+this.id+"]"},t.bubble=function(t){for(var e=f.call(arguments,1),n=this;n;n=n.parent){var i=n[t]&&n[t].apply(n,e);if(i===!1)break}return this},t.postOrder=function(t){var e=f.call(arguments,1);if("string"==typeof t){var n=t;t=function(t){n in t&&t[n].apply(t,e)}}!function e(n){n.eachChild(e),t(n)}(this)},t.jQ=w(),t.jQadd=function(t){this.jQ=this.jQ.add(t)},this.jQize=function(t){var e=w(t);return e.find("*").andSelf().each(function(){var t=w(this),e=t.attr("mathquill-command-id"),n=t.attr("mathquill-block-id");e&&y[e].jQadd(t),n&&y[n].jQadd(t)}),e},t.finalizeInsert=function(){var t=this;t.postOrder("finalizeTree"),t.postOrder("blur"),t.postOrder("respace"),t[b].respace&&t[b].respace(),t[v].respace&&t[v].respace(),t.postOrder("redraw"),t.bubble("redraw")}}),Q=d(y,function(e,i){e.init=function(t,e,n){var r=this;i.init.call(r),r.ctrlSeq||(r.ctrlSeq=t),e&&(r.htmlTemplate=e),n&&(r.textTemplate=n)},e.replaces=function(t){t.disown(),this.replacedFragment=t},e.isEmpty=function(){return this.foldChildren(!0,function(t,e){return t&&e.isEmpty()})},e.parser=function(){var t=ot.block,e=this;return t.times(e.numBlocks()).map(function(t){e.blocks=t;for(var n=0;n<t.length;n+=1)t[n].adopt(e,e.ends[b],0);return e})},e.createLeftOf=function(t){var e=this,n=e.replacedFragment;e.createBlocks(),y.jQize(e.html()),n&&(n.adopt(e.ends[v],0,0),n.jQ.appendTo(e.ends[v].jQ)),t.jQ.before(e.jQ),t[v]=e.adopt(t.parent,t[v],t[b]),e.finalizeInsert(t),e.placeCursor(t)},e.createBlocks=function(){for(var t=this,e=t.numBlocks(),n=t.blocks=Array(e),i=0;i<e;i+=1){var r=n[i]=S();r.adopt(t,t.ends[b],0)}},e.respace=t,e.placeCursor=function(t){t.insAtRightEnd(this.foldChildren(this.ends[v],function(t,e){return t.isEmpty()?t:e}))},e.remove=function(){return this.disown(),this.jQ.remove(),this.postOrder(function(t){delete y[t.id]}),this},e.numBlocks=function(){var t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0},e.html=function(){var t=this,e=t.blocks,i=" mathquill-command-id="+t.id,r=t.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);n("no unmatched angle brackets",r.join("")===this.htmlTemplate);for(var s=0,a=r[0];a;s+=1,a=r[s])if("/>"===a.slice(-2))r[s]=a.slice(0,-2)+i+"/>";else if("<"===a.charAt(0)){n("not an unmatched top-level close tag","/"!==a.charAt(1)),r[s]=a.slice(0,-1)+i+">";var o=1;do s+=1,a=r[s],n("no missing close tags",a),"</"===a.slice(0,2)?o-=1:"<"===a.charAt(0)&&"/>"!==a.slice(-2)&&(o+=1);while(o>0)}return r.join("").replace(/>&(\d+)/g,function(t,n){return" mathquill-block-id="+e[n].id+">"+e[n].join("html")})},e.latex=function(){return this.foldChildren(this.ctrlSeq,function(t,e){return t+"{"+(e.latex()||" ")+"}"})},e.textTemplate=[""],e.text=function(){var t=this,e=0;return t.foldChildren(t.textTemplate[e],function(n,i){e+=1;var r=i.text();return n&&"("===t.textTemplate[e]&&"("===r[0]&&")"===r.slice(-1)?n+r.slice(1,-1)+t.textTemplate[e]:n+i.text()+(t.textTemplate[e]||"")})}}),C=d(Q,function(e,n){e.init=function(t,e,i){i||(i=t&&t.length>1?t.slice(1):t),n.init.call(this,t,e,[i])},e.parser=function(){return g.succeed(this)},e.numBlocks=function(){return 0},e.replaces=function(t){t.remove()},e.createBlocks=t,e.latex=function(){return this.ctrlSeq},e.text=function(){return this.textTemplate},e.placeCursor=t,e.isEmpty=function(){return!0}}),S=d(y,function(t){t.join=function(t){return this.foldChildren("",function(e,n){return e+n[t]()})},t.latex=function(){return this.join("latex")},t.text=function(){return this.ends[v]===this.ends[b]?this.ends[v].text():"("+this.join("text")+")"},t.isEmpty=function(){return 0===this.ends[v]&&0===this.ends[b]},t.write=function(t,e,n){var i;i=e.match(/^[a-eg-zA-Z]$/)?V(e):(i=A[e]||R[e])?i(e):tt(e),n&&i.replaces(n),i.createLeftOf(t)},t.focus=function(){return this.jQ.addClass("hasCursor"),this.jQ.removeClass("empty"),this},t.blur=function(){return this.jQ.removeClass("hasCursor"),this.isEmpty()&&this.jQ.addClass("empty"),this}}),L=d(k,function(t,e){t.init=function(t,n){e.init.call(this,t,n||t),this.jQ=this.fold(w(),function(t,e){return e.jQ.add(t)})},t.latex=function(){return this.fold("",function(t,e){return t+e.latex()})},t.remove=function(){return this.jQ.remove(),this.each(function(t){t.postOrder(function(t){delete y[t.id]})}),this.disown()}}),D=d(S,function(t,e){t.latex=function(){return e.latex.call(this).replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},t.text=function(){return this.foldChildren("",function(t,e){return t+e.text()})},t.renderLatex=function(t){var e=this.jQ;e.children().slice(1).remove(),this.ends[v]=this.ends[b]=0,delete this.cursor.selection,this.cursor.insAtRightEnd(this).writeLatex(t)},t.onKey=function(t,e){switch(t){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":for(;this.cursor[v]||this.cursor.selection;)this.cursor.backspace();break;case"Shift-Backspace":case"Backspace":this.cursor.backspace();break;case"Esc":case"Tab":case"Spacebar":var n=this.cursor.parent;if(n===this.cursor.root)return void("Spacebar"===t&&e.preventDefault());this.cursor.prepareMove(),n[b]?this.cursor.insAtLeftEnd(n[b]):this.cursor.insRightOf(n.parent);break;case"Shift-Tab":case"Shift-Esc":case"Shift-Spacebar":var n=this.cursor.parent;if(n===this.cursor.root)return void("Shift-Spacebar"===t&&e.preventDefault());this.cursor.prepareMove(),n[v]?this.cursor.insAtRightEnd(n[v]):this.cursor.insLeftOf(n.parent);break;case"Enter":break;case"End":this.cursor.prepareMove().insAtRightEnd(this.cursor.parent);break;case"Ctrl-End":this.cursor.prepareMove().insAtRightEnd(this);break;case"Shift-End":for(;this.cursor[b];)this.cursor.selectRight();break;case"Ctrl-Shift-End":for(;this.cursor[b]||this.cursor.parent!==this;)this.cursor.selectRight();break;case"Home":this.cursor.prepareMove().insAtLeftEnd(this.cursor.parent);break;case"Ctrl-Home":this.cursor.prepareMove().insAtLeftEnd(this);break;case"Shift-Home":for(;this.cursor[v];)this.cursor.selectLeft();break;case"Ctrl-Shift-Home":for(;this.cursor[v]||this.cursor.parent!==this;)this.cursor.selectLeft();break;case"Left":this.cursor.moveLeft();break;case"Shift-Left":this.cursor.selectLeft();break;case"Ctrl-Left":break;case"Right":this.cursor.moveRight();break;case"Shift-Right":this.cursor.selectRight();break;case"Ctrl-Right":break;case"Up":this.cursor.moveUp();break;case"Down":this.cursor.moveDown();break;case"Shift-Up":if(this.cursor[v])for(;this.cursor[v];)this.cursor.selectLeft();else this.cursor.selectLeft();case"Shift-Down":if(this.cursor[b])for(;this.cursor[b];)this.cursor.selectRight();else this.cursor.selectRight();case"Ctrl-Up":break;case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":for(;this.cursor[b]||this.cursor.selection;)this.cursor.deleteForward();break;case"Shift-Del":case"Del":this.cursor.deleteForward();break;case"Meta-A":case"Ctrl-A":if(this!==this.cursor.root)return;for(this.cursor.prepareMove().insAtRightEnd(this);this.cursor[v];)this.cursor.selectLeft();break;default:return!1}return e.preventDefault(),!1},t.onText=function(t){return this.cursor.write(t),!1}}),O=d(Q,function(t,e){t.init=function(t){e.init.call(this,"$"),this.cursor=t},t.htmlTemplate='<span class="mathquill-rendered-math">&0</span>',t.createBlocks=function(){this.ends[v]=this.ends[b]=D(),this.blocks=[this.ends[v]],this.ends[v].parent=this,this.ends[v].cursor=this.cursor,this.ends[v].write=function(t,e,n){"$"!==e?S.prototype.write.call(this,t,e,n):this.isEmpty()?(t.insRightOf(this.parent).backspace().show(),tt("\\$","$").createLeftOf(t)):t[b]?t[v]?S.prototype.write.call(this,t,e,n):t.insLeftOf(this.parent):t.insRightOf(this.parent)}},t.latex=function(){return"$"+this.ends[v].latex()+"$"}}),E=d(S,function(t){t.renderLatex=function(t){var e=this,n=e.cursor;e.jQ.children().slice(1).remove(),e.ends[v]=e.ends[b]=0,delete n.selection,n.show().insAtRightEnd(e);var i=g.regex,r=g.string,s=g.eof,a=g.all,o=r("$").then(ot).skip(r("$").or(s)).map(function(t){var e=O(n);e.createBlocks();var i=e.ends[v];return t.children().adopt(i,0,0),e}),c=r("\\$").result("$"),h=c.or(i(/^[^$]/)).map(tt),l=o.or(h).many(),u=l.skip(s).or(a.result(!1)).parse(t);if(u){for(var p=0;p<u.length;p+=1)u[p].adopt(e,e.ends[b],0);var f=e.join("html");y.jQize(f).appendTo(e.jQ),this.finalizeInsert()}},t.onKey=function(t){"Spacebar"!==t&&"Shift-Spacebar"!==t&&D.prototype.onKey.apply(this,arguments)},t.onText=D.prototype.onText,t.write=function(t,e,n){if(n&&n.remove(),"$"===e)O(t).createLeftOf(t);else{var i;"<"===e?i="&lt;":">"===e&&(i="&gt;"),tt(e,i).createLeftOf(t)}}}),A={},R={},T=t,z=document.createElement("div"),B=z.style,I={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1};for(var $ in I)if($ in B){c=$;break}c?o=function(t,e,n){t.css(c,"scale("+e+","+n+")")}:"filter"in B?(T=function(t){t.className=t.className},o=function(t,e,n){function i(){t.css("marginRight",(r.width()-1)*(e-1)/e+"px")}e/=1+(n-1)/2,t.css("fontSize",n+"em"),t.hasClass("matrixed-container")||t.addClass("matrixed-container").wrapInner('<span class="matrixed"></span>');var r=t.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+e+",SizingMethod='auto expand')");i();var s=setInterval(i);w(window).load(function(){clearTimeout(s),i()})}):o=function(t,e,n){t.css("fontSize",n+"em")};var _=d(Q,function(t,e){t.init=function(t,n,i){e.init.call(this,t,"<"+n+" "+i+">&0</"+n+">")}});R.mathrm=e(_,"\\mathrm","span",'class="roman font"'),R.mathit=e(_,"\\mathit","i",'class="font"'),R.mathbf=e(_,"\\mathbf","b",'class="font"'),R.mathsf=e(_,"\\mathsf","span",'class="sans-serif font"'),R.mathtt=e(_,"\\mathtt","span",'class="monospace font"'),R.underline=e(_,"\\underline","span",'class="non-leaf underline"'),R.overline=R.bar=e(_,"\\overline","span",'class="non-leaf overline"');var W=d(Q,function(t,e){t.init=function(t,n,i){e.init.call(this,t,"<"+n+' class="non-leaf">&0</'+n+">",[i])},t.finalizeTree=function(){function t(t){var e=this.parent,n=t;do{if(n[b])return t.insLeftOf(e),!1;n=n.parent.parent}while(n!==e);return t.insRightOf(e),!1}n("SupSub is only _ and ^","^"===this.ctrlSeq||"_"===this.ctrlSeq),"_"===this.ctrlSeq?(this.down=this.ends[v],this.ends[v].up=t):(this.up=this.ends[v],this.ends[v].down=t)},t.latex=function(){var t=this.ends[v].latex();return 1===t.length?this.ctrlSeq+t:this.ctrlSeq+"{"+(t||" ")+"}"},t.redraw=function(){this[v]&&this[v].respace(),this[v]instanceof W||(this.respace(),!this[b]||this[b]instanceof W||this[b].respace())},t.respace=function(){if("\\int "===this[v].ctrlSeq||this[v]instanceof W&&this[v].ctrlSeq!=this.ctrlSeq&&this[v][v]&&"\\int "===this[v][v].ctrlSeq?this.limit||(this.limit=!0,this.jQ.addClass("limit")):this.limit&&(this.limit=!1,this.jQ.removeClass("limit")),this.respaced=this[v]instanceof W&&this[v].ctrlSeq!=this.ctrlSeq&&!this[v].respaced,this.respaced){var t=+this.jQ.css("fontSize").slice(0,-2),e=this[v].jQ.outerWidth(),n=this.jQ.outerWidth();this.jQ.css({left:(this.limit&&"_"===this.ctrlSeq?-.25:0)-e/t+"em",marginRight:.1-p(n,e)/t+"em"})}else this.limit&&"_"===this.ctrlSeq?this.jQ.css({left:"-.25em",marginRight:""}):this.jQ.css({left:"",marginRight:""});return this[b]instanceof W&&this[b].respace(),this}});R.subscript=R._=e(W,"_","sub","_"),R.superscript=R.supscript=R["^"]=e(W,"^","sup","**");var M=R.frac=R.dfrac=R.cfrac=R.fraction=d(Q,function(t,e){t.ctrlSeq="\\frac",t.htmlTemplate='<span class="fraction non-leaf"><span class="numerator">&0</span><span class="denominator">&1</span><span style="display:inline-block;width:0">&nbsp;</span></span>',t.textTemplate=["(","/",")"],t.finalizeTree=function(){this.up=this.ends[b].up=this.ends[v],this.down=this.ends[v].down=this.ends[b]}}),F=R.over=A["/"]=d(M,function(t,e){t.createLeftOf=function(t){if(!this.replacedFragment){for(var n=t[v];n&&!(n instanceof it||n instanceof Z||n instanceof st||",;:".split("").indexOf(n.ctrlSeq)>-1);)n=n[v];n instanceof st&&n[b]instanceof W&&(n=n[b],n[b]instanceof W&&n[b].ctrlSeq!=n.ctrlSeq&&(n=n[b])),n!==t[v]&&(this.replaces(L(n[b]||t.parent.ends[v],t[v])),t[v]=n)}e.createLeftOf.call(this,t)}}),P=R.sqrt=R["√"]=d(Q,function(t,e){t.ctrlSeq="\\sqrt",t.htmlTemplate='<span class="non-leaf"><span class="scaled sqrt-prefix">&radic;</span><span class="non-leaf sqrt-stem">&0</span></span>',t.textTemplate=["sqrt(",")"],t.parser=function(){return ot.optBlock.then(function(t){return ot.block.map(function(e){var n=U();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(e.parser.call(this))},t.redraw=function(){var t=this.ends[b].jQ;o(t.prev(),1,t.innerHeight()/+t.css("fontSize").slice(0,-2)-.1)}}),U=(R.vec=d(Q,function(t,e){t.ctrlSeq="\\vec",t.htmlTemplate='<span class="non-leaf"><span class="vector-prefix">&rarr;</span><span class="vector-stem">&0</span></span>',t.textTemplate=["vec(",")"]}),R.nthroot=d(P,function(t,e){t.htmlTemplate='<sup class="nthroot non-leaf">&0</sup><span class="scaled"><span class="sqrt-prefix scaled">&radic;</span><span class="sqrt-stem non-leaf">&1</span></span>',t.textTemplate=["sqrt[","](",")"],t.latex=function(){return"\\sqrt["+this.ends[v].latex()+"]{"+this.ends[b].latex()+"}"}})),H=d(Q,function(t,e){t.init=function(t,n,i,r){e.init.call(this,"\\left"+i,'<span class="non-leaf"><span class="scaled paren">'+t+'</span><span class="non-leaf">&0</span><span class="scaled paren">'+n+"</span></span>",[t,n]),this.end="\\right"+r},t.jQadd=function(){e.jQadd.apply(this,arguments);var t=this.jQ;this.bracketjQs=t.children(":first").add(t.children(":last"))},t.latex=function(){return this.ctrlSeq+this.ends[v].latex()+this.end},t.redraw=function(){var t=this.ends[v].jQ,e=t.outerHeight()/+t.css("fontSize").slice(0,-2);o(this.bracketjQs,p(1+.2*(e-1),1.2),1.05*e)}});R.left=d(Q,function(t){t.parser=function(){var t=g.regex,e=g.string,n=g.succeed,i=g.optWhitespace;return i.then(t(/^(?:[([|]|\\\{)/)).then(function(r){"\\"===r.charAt(0)&&(r=r.slice(1));var s=A[r]();return ot.map(function(t){s.blocks=[t],t.adopt(s,0,0)}).then(e("\\right")).skip(i).then(t(/^(?:[\])|]|\\\})/)).then(function(t){return t.slice(-1)!==s.end.slice(-1)?g.fail("open doesn't match close"):n(s)})})}}),R.right=d(Q,function(t){t.parser=function(){return g.fail("unmatched \\right")}}),R.lbrace=A["{"]=e(H,"{","}","\\{","\\}"),R.langle=R.lang=e(H,"&lang;","&rang;","\\langle ","\\rangle ");var K=d(H,function(t,e){t.createLeftOf=function(t){t[b]||!t.parent.parent||t.parent.parent.end!==this.end||this.replacedFragment?e.createLeftOf.call(this,t):t.insRightOf(t.parent.parent)},t.placeCursor=function(t){this.ends[v].blur(),t.insRightOf(this)}});R.rbrace=A["}"]=e(K,"{","}","\\{","\\}"),R.rangle=R.rang=e(K,"&lang;","&rang;","\\langle ","\\rangle ");var N=function(t,e){t.init=function(t,n){e.init.call(this,t,n,t,n)}},G=d(H,N);R.lparen=A["("]=e(G,"(",")"),R.lbrack=R.lbracket=A["["]=e(G,"[","]");var X=d(K,N);R.rparen=A[")"]=e(X,"(",")"),R.rbrack=R.rbracket=A["]"]=e(X,"[","]");var Z=(R.lpipe=R.rpipe=A["|"]=d(G,function(t,e){t.init=function(){e.init.call(this,"|","|")},t.createLeftOf=K.prototype.createLeftOf}),A.$=R.text=R.textnormal=R.textrm=R.textup=R.textmd=d(Q,function(t,e){t.ctrlSeq="\\text",t.htmlTemplate='<span class="text">&0</span>',t.replaces=function(t){t instanceof L?this.replacedText=t.remove().jQ.text():"string"==typeof t&&(this.replacedText=t)},t.textTemplate=['"','"'],t.parser=function(){var t=this,e=g.string,n=g.regex,i=g.optWhitespace;return i.then(e("{")).then(n(/^[^}]*/)).skip(e("}")).map(function(e){t.createBlocks();for(var n=t.ends[v],i=0;i<e.length;i+=1){var r=tt(e.charAt(i));r.adopt(n,n.ends[b],0)}return t})},t.createBlocks=function(){this.ends[v]=this.ends[b]=Y(),this.blocks=[this.ends[v]],this.ends[v].parent=this},t.finalizeInsert=function(){this.ends[v].blur=function(){return delete this.blur,this},e.finalizeInsert.call(this)},t.createLeftOf=function(t){if(e.createLeftOf.call(this,this.cursor=t),this.replacedText)for(var n=0;n<this.replacedText.length;n+=1)this.ends[v].write(t,this.replacedText.charAt(n))}})),Y=d(S,function(t,e){t.onKey=function(t,e){if("Spacebar"===t||"Shift-Spacebar"===t)return!1},t.deleteOutOf=function(t,e){this.isEmpty()&&e.insRightOf(this.parent)},t.write=function(t,e,n){if(n&&n.remove(),"$"!==e){var i;"<"===e?i="&lt;":">"===e&&(i="&gt;"),tt(e,i).createLeftOf(t)}else if(this.isEmpty())t.insRightOf(this.parent).backspace(),tt("\\$","$").createLeftOf(t);else if(t[b])if(t[v]){var r=Z();r.replaces(L(t[b],this.ends[b])),t.insRightOf(this.parent),r.adopt=function(){delete this.adopt,this.adopt.apply(this,arguments),this[v]=0},r.createLeftOf(t),r[v]=this.parent,t.insLeftOf(r)}else t.insLeftOf(this.parent);else t.insRightOf(this.parent);return!1},t.blur=function(){if(this.jQ.removeClass("hasCursor"),this.isEmpty()){var t=this.parent,e=t.cursor;e.parent===this?this.jQ.addClass("empty"):(e.hide(),t.remove(),e[b]===t?e[b]=t[b]:e[v]===t&&(e[v]=t[v]),e.show().parent.bubble("redraw"))}return this},t.focus=function(){e.focus.call(this);var t=this.parent;if(t[b].ctrlSeq===t.ctrlSeq){var n=this,i=t.cursor,r=t[b].ends[v];r.eachChild(function(t){t.parent=n,t.jQ.appendTo(n.jQ)}),this.ends[b]?this.ends[b][b]=r.ends[v]:this.ends[v]=r.ends[v],r.ends[v][v]=this.ends[b],this.ends[b]=r.ends[b],r.parent.remove(),i[v]?i.insRightOf(i[v]):i.insAtLeftEnd(this),i.parent.bubble("redraw")}else if(t[v].ctrlSeq===t.ctrlSeq){var i=t.cursor;i[v]?t[v].ends[v].focus():i.insAtRightEnd(t[v].ends[v])}return this}});R.em=R.italic=R.italics=R.emph=R.textit=R.textsl=s("\\textit","i",'class="text"'),R.strong=R.bold=R.textbf=s("\\textbf","b",'class="text"'),R.sf=R.textsf=s("\\textsf","span",'class="sans-serif text"'),R.tt=R.texttt=s("\\texttt","span",'class="monospace text"'),R.textsc=s("\\textsc","span",'style="font-variant:small-caps" class="text"'),R.uppercase=s("\\uppercase","span",'style="text-transform:uppercase" class="text"'),R.lowercase=s("\\lowercase","span",'style="text-transform:lowercase" class="text"');var J=(A["\\"]=d(Q,function(t,e){t.ctrlSeq="\\",t.replaces=function(t){this._replacedFragment=t.disown(),this.isEmpty=function(){return!1}},t.htmlTemplate='<span class="latex-command-input non-leaf">\\<span>&0</span></span>',t.textTemplate=["\\"],t.createBlocks=function(){e.createBlocks.call(this),this.ends[v].focus=function(){return this.parent.jQ.addClass("hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("empty"),this},this.ends[v].blur=function(){return this.parent.jQ.removeClass("hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("empty"),this}},t.createLeftOf=function(t){if(e.createLeftOf.call(this,t),this.cursor=t.insAtRightEnd(this.ends[v]),this._replacedFragment){var n=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("blur").bind("mousedown mousemove",function(t){return w(t.target=n).trigger(t),!1}).insertBefore(this.jQ).add(this.jQ)}this.ends[v].write=function(t,e,n){n&&n.remove(),e.match(/[a-z]/i)?tt(e).createLeftOf(t):(this.parent.renderCommand(),"\\"===e&&this.isEmpty()||this.parent.parent.write(t,e))}},t.latex=function(){return"\\"+this.ends[v].latex()+" "},t.onKey=function(t,e){if("Tab"===t||"Enter"===t||"Spacebar"===t)return this.renderCommand(),e.preventDefault(),!1},t.renderCommand=function(){this.jQ=this.jQ.last(),this.remove(),this[b]?this.cursor.insLeftOf(this[b]):this.cursor.insAtRightEnd(this.parent);var t=this.ends[v].latex();t||(t="backslash"),this.cursor.insertCmd(t,this._replacedFragment)}}),R.binom=R.binomial=d(Q,function(t,e){t.ctrlSeq="\\binom",t.htmlTemplate='<span class="paren scaled">(</span><span class="non-leaf"><span class="array non-leaf"><span>&0</span><span>&1</span></span></span><span class="paren scaled">)</span>',t.textTemplate=["choose(",",",")"],t.redraw=function(){var t=this.jQ.eq(1),e=t.outerHeight()/+t.css("fontSize").slice(0,-2),n=this.jQ.filter(".paren");o(n,p(1+.2*(e-1),1.2),1.05*e)}}));R.choose=d(J,function(t){t.createLeftOf=F.prototype.createLeftOf}),R.vector=d(Q,function(t,e){t.ctrlSeq="\\vector",t.htmlTemplate='<span class="array"><span>&0</span></span>',t.latex=function(){return"\\begin{matrix}"+this.foldChildren([],function(t,e){return t.push(e.latex()),t}).join("\\\\")+"\\end{matrix}"},t.text=function(){return"["+this.foldChildren([],function(t,e){return t.push(e.text()),t}).join()+"]"},t.createLeftOf=function(t){e.createLeftOf.call(this,this.cursor=t)},t.onKey=function(t,e){var n=this.cursor.parent;if(n.parent===this){if("Enter"===t){var i=S();return i.parent=this,i.jQ=w("<span></span>").attr(u,i.id).insertAfter(n.jQ),n[b]?n[b][v]=i:this.ends[b]=i,i[b]=n[b],n[b]=i,i[v]=n,this.bubble("redraw").cursor.insAtRightEnd(i),e.preventDefault(),!1}if("Tab"===t&&!n[b]){if(n.isEmpty())return n[v]?(this.cursor.insRightOf(this),delete n[v][b],this.ends[b]=n[v],n.jQ.remove(),this.bubble("redraw"),e.preventDefault(),!1):void 0;var i=S();return i.parent=this,i.jQ=w("<span></span>").attr(u,i.id).appendTo(this.jQ),this.ends[b]=i,n[b]=i,i[v]=n,this.bubble("redraw").cursor.insAtRightEnd(i),e.preventDefault(),!1}if(8===e.which){if(n.isEmpty())return n[v]?(this.cursor.insAtRightEnd(n[v]),n[v][b]=n[b]):(this.cursor.insLeftOf(this),this.ends[v]=n[b]),n[b]?n[b][v]=n[v]:this.ends[b]=n[v],n.jQ.remove(),this.isEmpty()?this.cursor.deleteForward():this.bubble("redraw"),e.preventDefault(),!1;if(!this.cursor[v])return e.preventDefault(),!1}}}});R.editable=d(O,function(t,e){t.init=function(){Q.prototype.init.call(this,"\\editable")},t.jQadd=function(){var t=this;e.jQadd.apply(t,arguments);var n=t.ends[v].disown(),i=t.jQ.children().detach();t.ends[v]=t.ends[b]=D(),t.blocks=[t.ends[v]],t.ends[v].parent=t,r(t.jQ,t.ends[v],!1,!0),t.cursor=t.ends[v].cursor,n.children().adopt(t.ends[v],0,0),i.appendTo(t.ends[v].jQ),t.ends[v].cursor.insAtRightEnd(t.ends[v])},t.latex=function(){return this.ends[v].latex()},t.text=function(){return this.ends[v].text()}}),R.f=e(C,"f",'<var class="florin">&fnof;</var><span style="display:inline-block;width:0">&nbsp;</span>');var V=d(C,function(t,e){t.init=function(t,n){e.init.call(this,t,"<var>"+(n||t)+"</var>")},t.text=function(){var t=this.ctrlSeq;return!this[v]||this[v]instanceof V||this[v]instanceof it||(t="*"+t),!this[b]||this[b]instanceof it||"^"===this[b].ctrlSeq||(t+="*"),t}}),tt=d(C,function(t,e){t.init=function(t,n){e.init.call(this,t,"<span>"+(n||t)+"</span>")}});A[" "]=e(tt,"\\:"," "),R.prime=A["'"]=e(tt,"'","&prime;");var et=d(C,function(t,e){t.init=function(t,n){e.init.call(this,t,'<span class="nonSymbola">'+(n||t)+"</span>")}});R["@"]=et,R["&"]=e(et,"\\&","&amp;"),R["%"]=e(et,"\\%","%"),R.alpha=R.beta=R.gamma=R.delta=R.zeta=R.eta=R.theta=R.iota=R.kappa=R.mu=R.nu=R.xi=R.rho=R.sigma=R.tau=R.chi=R.psi=R.omega=d(V,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),R.phi=e(V,"\\phi ","&#981;"),R.phiv=R.varphi=e(V,"\\varphi ","&phi;"),R.epsilon=e(V,"\\epsilon ","&#1013;"),R.epsiv=R.varepsilon=e(V,"\\varepsilon ","&epsilon;"),R.piv=R.varpi=e(V,"\\varpi ","&piv;"),R.sigmaf=R.sigmav=R.varsigma=e(V,"\\varsigma ","&sigmaf;"),R.thetav=R.vartheta=R.thetasym=e(V,"\\vartheta ","&thetasym;"),R.upsilon=R.upsi=e(V,"\\upsilon ","&upsilon;"),R.gammad=R.Gammad=R.digamma=e(V,"\\digamma ","&#989;"),R.kappav=R.varkappa=e(V,"\\varkappa ","&#1008;"),R.rhov=R.varrho=e(V,"\\varrho ","&#1009;"),R.pi=R["π"]=e(et,"\\pi ","&pi;"),R.lambda=e(et,"\\lambda ","&lambda;"),R.Upsilon=R.Upsi=R.upsih=R.Upsih=e(C,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),R.Gamma=R.Delta=R.Theta=R.Lambda=R.Xi=R.Pi=R.Sigma=R.Phi=R.Psi=R.Omega=R.forall=d(tt,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}});var nt=d(Q,function(t){t.init=function(t){this.latex=t},t.createLeftOf=function(t){t.writeLatex(this.latex)},t.parser=function(){var t=ot.parse(this.latex).children();
return g.succeed(t)}});R["¹"]=e(nt,"^1"),R["²"]=e(nt,"^2"),R["³"]=e(nt,"^3"),R["¼"]=e(nt,"\\frac14"),R["½"]=e(nt,"\\frac12"),R["¾"]=e(nt,"\\frac34");var it=d(C,function(t,e){t.init=function(t,n,i){e.init.call(this,t,'<span class="binary-operator">'+n+"</span>",i)}}),rt=d(it,function(t){t.init=tt.prototype.init,t.respace=function(){return this[v]?this[v]instanceof it&&this[b]&&!(this[b]instanceof it)?this.jQ[0].className="unary-operator":this.jQ[0].className="binary-operator":this.jQ[0].className="",this}});R["+"]=e(rt,"+","+"),R["–"]=R["-"]=e(rt,"-","&minus;"),R["±"]=R.pm=R.plusmn=R.plusminus=e(rt,"\\pm ","&plusmn;"),R.mp=R.mnplus=R.minusplus=e(rt,"\\mp ","&#8723;"),A["*"]=R.sdot=R.cdot=e(it,"\\cdot ","&middot;"),R["="]=e(it,"=","="),R["<"]=e(it,"<","&lt;"),R[">"]=e(it,">","&gt;"),R.notin=R.sim=R.cong=R.equiv=R.oplus=R.otimes=d(it,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),R.times=e(it,"\\times ","&times;","[x]"),R["÷"]=R.div=R.divide=R.divides=e(it,"\\div ","&divide;","[/]"),R["≠"]=R.ne=R.neq=e(it,"\\ne ","&ne;"),R.ast=R.star=R.loast=R.lowast=e(it,"\\ast ","&lowast;"),R.therefor=R.therefore=e(it,"\\therefore ","&there4;"),R.cuz=R.because=e(it,"\\because ","&#8757;"),R.prop=R.propto=e(it,"\\propto ","&prop;"),R["≈"]=R.asymp=R.approx=e(it,"\\approx ","&asymp;"),R.lt=e(it,"<","&lt;"),R.gt=e(it,">","&gt;"),R["≤"]=R.le=R.leq=e(it,"\\le ","&le;"),R["≥"]=R.ge=R.geq=e(it,"\\ge ","&ge;"),R.isin=R.in=e(it,"\\in ","&isin;"),R.ni=R.contains=e(it,"\\ni ","&ni;"),R.notni=R.niton=R.notcontains=R.doesnotcontain=e(it,"\\not\\ni ","&#8716;"),R.sub=R.subset=e(it,"\\subset ","&sub;"),R.sup=R.supset=R.superset=e(it,"\\supset ","&sup;"),R.nsub=R.notsub=R.nsubset=R.notsubset=e(it,"\\not\\subset ","&#8836;"),R.nsup=R.notsup=R.nsupset=R.notsupset=R.nsuperset=R.notsuperset=e(it,"\\not\\supset ","&#8837;"),R.sube=R.subeq=R.subsete=R.subseteq=e(it,"\\subseteq ","&sube;"),R.supe=R.supeq=R.supsete=R.supseteq=R.supersete=R.superseteq=e(it,"\\supseteq ","&supe;"),R.nsube=R.nsubeq=R.notsube=R.notsubeq=R.nsubsete=R.nsubseteq=R.notsubsete=R.notsubseteq=e(it,"\\not\\subseteq ","&#8840;"),R.nsupe=R.nsupeq=R.notsupe=R.notsupeq=R.nsupsete=R.nsupseteq=R.notsupsete=R.notsupseteq=R.nsupersete=R.nsuperseteq=R.notsupersete=R.notsuperseteq=e(it,"\\not\\supseteq ","&#8841;");var st=d(C,function(t,e){t.init=function(t,n){e.init.call(this,t,"<big>"+n+"</big>")}});R["∑"]=R.sum=R.summation=e(st,"\\sum ","&sum;"),R["∏"]=R.prod=R.product=e(st,"\\prod ","&prod;"),R.coprod=R.coproduct=e(st,"\\coprod ","&#8720;"),R["∫"]=R.int=R.integral=e(st,"\\int ","&int;"),R.N=R.naturals=R.Naturals=e(tt,"\\mathbb{N}","&#8469;"),R.P=R.primes=R.Primes=R.projective=R.Projective=R.probability=R.Probability=e(tt,"\\mathbb{P}","&#8473;"),R.Z=R.integers=R.Integers=e(tt,"\\mathbb{Z}","&#8484;"),R.Q=R.rationals=R.Rationals=e(tt,"\\mathbb{Q}","&#8474;"),R.R=R.reals=R.Reals=e(tt,"\\mathbb{R}","&#8477;"),R.C=R.complex=R.Complex=R.complexes=R.Complexes=R.complexplane=R.Complexplane=R.ComplexPlane=e(tt,"\\mathbb{C}","&#8450;"),R.H=R.Hamiltonian=R.quaternions=R.Quaternions=e(tt,"\\mathbb{H}","&#8461;"),R.quad=R.emsp=e(tt,"\\quad ","    "),R.qquad=e(tt,"\\qquad ","        "),R.diamond=e(tt,"\\diamond ","&#9671;"),R.bigtriangleup=e(tt,"\\bigtriangleup ","&#9651;"),R.ominus=e(tt,"\\ominus ","&#8854;"),R.uplus=e(tt,"\\uplus ","&#8846;"),R.bigtriangledown=e(tt,"\\bigtriangledown ","&#9661;"),R.sqcap=e(tt,"\\sqcap ","&#8851;"),R.triangleleft=e(tt,"\\triangleleft ","&#8882;"),R.sqcup=e(tt,"\\sqcup ","&#8852;"),R.triangleright=e(tt,"\\triangleright ","&#8883;"),R.odot=e(tt,"\\odot ","&#8857;"),R.bigcirc=e(tt,"\\bigcirc ","&#9711;"),R.dagger=e(tt,"\\dagger ","&#0134;"),R.ddagger=e(tt,"\\ddagger ","&#135;"),R.wr=e(tt,"\\wr ","&#8768;"),R.amalg=e(tt,"\\amalg ","&#8720;"),R.models=e(tt,"\\models ","&#8872;"),R.prec=e(tt,"\\prec ","&#8826;"),R.succ=e(tt,"\\succ ","&#8827;"),R.preceq=e(tt,"\\preceq ","&#8828;"),R.succeq=e(tt,"\\succeq ","&#8829;"),R.simeq=e(tt,"\\simeq ","&#8771;"),R.mid=e(tt,"\\mid ","&#8739;"),R.ll=e(tt,"\\ll ","&#8810;"),R.gg=e(tt,"\\gg ","&#8811;"),R.parallel=e(tt,"\\parallel ","&#8741;"),R.bowtie=e(tt,"\\bowtie ","&#8904;"),R.sqsubset=e(tt,"\\sqsubset ","&#8847;"),R.sqsupset=e(tt,"\\sqsupset ","&#8848;"),R.smile=e(tt,"\\smile ","&#8995;"),R.sqsubseteq=e(tt,"\\sqsubseteq ","&#8849;"),R.sqsupseteq=e(tt,"\\sqsupseteq ","&#8850;"),R.doteq=e(tt,"\\doteq ","&#8784;"),R.frown=e(tt,"\\frown ","&#8994;"),R.vdash=e(tt,"\\vdash ","&#8870;"),R.dashv=e(tt,"\\dashv ","&#8867;"),R.longleftarrow=e(tt,"\\longleftarrow ","&#8592;"),R.longrightarrow=e(tt,"\\longrightarrow ","&#8594;"),R.Longleftarrow=e(tt,"\\Longleftarrow ","&#8656;"),R.Longrightarrow=e(tt,"\\Longrightarrow ","&#8658;"),R.longleftrightarrow=e(tt,"\\longleftrightarrow ","&#8596;"),R.updownarrow=e(tt,"\\updownarrow ","&#8597;"),R.Longleftrightarrow=e(tt,"\\Longleftrightarrow ","&#8660;"),R.Updownarrow=e(tt,"\\Updownarrow ","&#8661;"),R.mapsto=e(tt,"\\mapsto ","&#8614;"),R.nearrow=e(tt,"\\nearrow ","&#8599;"),R.hookleftarrow=e(tt,"\\hookleftarrow ","&#8617;"),R.hookrightarrow=e(tt,"\\hookrightarrow ","&#8618;"),R.searrow=e(tt,"\\searrow ","&#8600;"),R.leftharpoonup=e(tt,"\\leftharpoonup ","&#8636;"),R.rightharpoonup=e(tt,"\\rightharpoonup ","&#8640;"),R.swarrow=e(tt,"\\swarrow ","&#8601;"),R.leftharpoondown=e(tt,"\\leftharpoondown ","&#8637;"),R.rightharpoondown=e(tt,"\\rightharpoondown ","&#8641;"),R.nwarrow=e(tt,"\\nwarrow ","&#8598;"),R.ldots=e(tt,"\\ldots ","&#8230;"),R.cdots=e(tt,"\\cdots ","&#8943;"),R.vdots=e(tt,"\\vdots ","&#8942;"),R.ddots=e(tt,"\\ddots ","&#8944;"),R.surd=e(tt,"\\surd ","&#8730;"),R.triangle=e(tt,"\\triangle ","&#9653;"),R.ell=e(tt,"\\ell ","&#8467;"),R.top=e(tt,"\\top ","&#8868;"),R.flat=e(tt,"\\flat ","&#9837;"),R.natural=e(tt,"\\natural ","&#9838;"),R.sharp=e(tt,"\\sharp ","&#9839;"),R.wp=e(tt,"\\wp ","&#8472;"),R.bot=e(tt,"\\bot ","&#8869;"),R.clubsuit=e(tt,"\\clubsuit ","&#9827;"),R.diamondsuit=e(tt,"\\diamondsuit ","&#9826;"),R.heartsuit=e(tt,"\\heartsuit ","&#9825;"),R.spadesuit=e(tt,"\\spadesuit ","&#9824;"),R.oint=e(tt,"\\oint ","&#8750;"),R.bigcap=e(tt,"\\bigcap ","&#8745;"),R.bigcup=e(tt,"\\bigcup ","&#8746;"),R.bigsqcup=e(tt,"\\bigsqcup ","&#8852;"),R.bigvee=e(tt,"\\bigvee ","&#8744;"),R.bigwedge=e(tt,"\\bigwedge ","&#8743;"),R.bigodot=e(tt,"\\bigodot ","&#8857;"),R.bigotimes=e(tt,"\\bigotimes ","&#8855;"),R.bigoplus=e(tt,"\\bigoplus ","&#8853;"),R.biguplus=e(tt,"\\biguplus ","&#8846;"),R.lfloor=e(tt,"\\lfloor ","&#8970;"),R.rfloor=e(tt,"\\rfloor ","&#8971;"),R.lceil=e(tt,"\\lceil ","&#8968;"),R.rceil=e(tt,"\\rceil ","&#8969;"),R.slash=e(tt,"\\slash ","&#47;"),R.opencurlybrace=e(tt,"\\opencurlybrace ","&#123;"),R.closecurlybrace=e(tt,"\\closecurlybrace ","&#125;"),R.caret=e(tt,"\\caret ","^"),R.underscore=e(tt,"\\underscore ","_"),R.backslash=e(tt,"\\backslash ","\\"),R.vert=e(tt,"|"),R.perp=R.perpendicular=e(tt,"\\perp ","&perp;"),R.nabla=R.del=e(tt,"\\nabla ","&nabla;"),R.hbar=e(tt,"\\hbar ","&#8463;"),R.AA=R.Angstrom=R.angstrom=e(tt,"\\text\\AA ","&#8491;"),R.ring=R.circ=R.circle=e(tt,"\\circ ","&#8728;"),R.bull=R.bullet=e(tt,"\\bullet ","&bull;"),R.setminus=R.smallsetminus=e(tt,"\\setminus ","&#8726;"),R.not=R["¬"]=R.neg=e(tt,"\\neg ","&not;"),R["…"]=R.dots=R.ellip=R.hellip=R.ellipsis=R.hellipsis=e(tt,"\\dots ","&hellip;"),R.converges=R.darr=R.dnarr=R.dnarrow=R.downarrow=e(tt,"\\downarrow ","&darr;"),R.dArr=R.dnArr=R.dnArrow=R.Downarrow=e(tt,"\\Downarrow ","&dArr;"),R.diverges=R.uarr=R.uparrow=e(tt,"\\uparrow ","&uarr;"),R.uArr=R.Uparrow=e(tt,"\\Uparrow ","&uArr;"),R.to=e(it,"\\to ","&rarr;"),R.rarr=R.rightarrow=e(tt,"\\rightarrow ","&rarr;"),R.implies=e(it,"\\Rightarrow ","&rArr;"),R.rArr=R.Rightarrow=e(tt,"\\Rightarrow ","&rArr;"),R.gets=e(it,"\\gets ","&larr;"),R.larr=R.leftarrow=e(tt,"\\leftarrow ","&larr;"),R.impliedby=e(it,"\\Leftarrow ","&lArr;"),R.lArr=R.Leftarrow=e(tt,"\\Leftarrow ","&lArr;"),R.harr=R.lrarr=R.leftrightarrow=e(tt,"\\leftrightarrow ","&harr;"),R.iff=e(it,"\\Leftrightarrow ","&hArr;"),R.hArr=R.lrArr=R.Leftrightarrow=e(tt,"\\Leftrightarrow ","&hArr;"),R.Re=R.Real=R.real=e(tt,"\\Re ","&real;"),R.Im=R.imag=R.image=R.imagin=R.imaginary=R.Imaginary=e(tt,"\\Im ","&image;"),R.part=R.partial=e(tt,"\\partial ","&part;"),R.inf=R.infin=R.infty=R.infinity=e(tt,"\\infty ","&infin;"),R.alef=R.alefsym=R.aleph=R.alephsym=e(tt,"\\aleph ","&alefsym;"),R.xist=R.xists=R.exist=R.exists=e(tt,"\\exists ","&exist;"),R.and=R.land=R.wedge=e(tt,"\\wedge ","&and;"),R.or=R.lor=R.vee=e(tt,"\\vee ","&or;"),R.o=R.O=R.empty=R.emptyset=R.oslash=R.Oslash=R.nothing=R.varnothing=e(it,"\\varnothing ","&empty;"),R.cup=R.union=e(it,"\\cup ","&cup;"),R.cap=R.intersect=R.intersection=e(it,"\\cap ","&cap;"),R.deg=R.degree=e(tt,"^\\circ ","&deg;"),R.ang=R.angle=e(tt,"\\angle ","&ang;");var at=d(C,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","<span>"+t+"</span>")},t.respace=function(){this.jQ[0].className=this[b]instanceof W||this[b]instanceof H?"":"non-italicized-function"}});R.ln=R.lg=R.log=R.span=R.proj=R.det=R.dim=R.min=R.max=R.mod=R.lcm=R.gcd=R.gcf=R.hcf=R.lim=at,function(){var t=["sin","cos","tan","sec","cosec","csc","cotan","cot"];for(var e in t)R[t[e]]=R[t[e]+"h"]=R["a"+t[e]]=R["arc"+t[e]]=R["a"+t[e]+"h"]=R["arc"+t[e]+"h"]=at}();var ot=function(){function t(t){var e=S();return t.adopt(e,0,0),e}function e(t){for(var e=t[0]||S(),n=1;n<t.length;n+=1)t[n].children().adopt(e,e.ends[b],0);return e}var n=g.string,i=g.regex,r=g.letter,s=g.any,a=g.optWhitespace,o=g.succeed,c=g.fail,h=r.map(V),l=i(/^[^${}\\_^]/).map(tt),u=i(/^[^\\a-eg-zA-Z]/).or(n("\\").then(i(/^[a-z]+/i).or(i(/^\s+/).result(" ")).or(s))).then(function(t){var e=R[t];return e?e(t).parser():c("unknown command: \\"+t)}),p=u.or(h).or(l),f=n("{").then(function(){return m}).skip(n("}")),d=a.then(f.or(p.map(t))),m=d.many().map(e).skip(a),v=n("[").then(d.then(function(t){return"]"!==t.join("latex")?o(t):c()}).many().map(e).skip(a)).skip(n("]")),w=m;return w.block=d,w.optBlock=v,w}(),ct=d(x,function(t){function e(t,e){if(t[b][e])t.insAtLeftEnd(t[b][e]);else if(t[v][e])t.insAtRightEnd(t[v][e]);else{var i=t.parent;do{var r=i[e];if(r&&("function"==typeof r&&(r=i[e](t)),r===!1||r instanceof S)){if(t.upDownCache[i.id]=x(t.parent,t[v],t[b]),r instanceof S){var s=t.upDownCache[r.id];if(s)s[b]?t.insLeftOf(s[b]):t.insAtRightEnd(s.parent);else{var a=n(t).left;t.insAtRightEnd(r),t.seekHoriz(a,r)}}break}i=i.parent.parent}while(i)}return t.clearSelection().show()}function n(t){var e=t.jQ.removeClass("cursor").offset();return t.jQ.addClass("cursor"),e}function r(t){t.upDownCache={}}t.init=function(t){this.parent=this.root=t;var e=this.jQ=this._jQ=w('<span class="cursor">&zwj;</span>');this.blink=function(){e.toggleClass("blink")},this.upDownCache={}},t.show=function(){return this.jQ=this._jQ.removeClass("blink"),"intervalId"in this?clearInterval(this.intervalId):(this[b]?this.selection&&this.selection.ends[v][v]===this[v]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[b].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},t.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=w(),this},t.withDirInsertAt=function(t,e,n,i){var r=this.parent;this.parent=e,this[t]=n,this[-t]=i,r.blur()},t.insDirOf=function(t,e){return i(t),this.withDirInsertAt(t,e.parent,e[t],e),this.parent.jQ.addClass("hasCursor"),this.jQ.insDirOf(t,e.jQ),this},t.insLeftOf=function(t){return this.insDirOf(v,t)},t.insRightOf=function(t){return this.insDirOf(b,t)},t.insAtDirEnd=function(t,e){return i(t),this.withDirInsertAt(t,e,0,e.ends[t]),t===v&&e.textarea?this.jQ.insDirOf(-t,e.textarea):this.jQ.insAtDirEnd(t,e.jQ),e.focus(),this},t.insAtLeftEnd=function(t){return this.insAtDirEnd(v,t)},t.insAtRightEnd=function(t){return this.insAtDirEnd(b,t)},t.hopDir=function(t){return i(t),this.jQ.insDirOf(t,this[t].jQ),this[-t]=this[t],this[t]=this[t][t],this},t.hopLeft=function(){return this.hopDir(v)},t.hopRight=function(){return this.hopDir(b)},t.moveDirWithin=function(t,e){if(i(t),this[t])this[t].ends[-t]?this.insAtDirEnd(-t,this[t].ends[-t]):this.hopDir(t);else{if(this.parent===e)return;this.parent[t]?this.insAtDirEnd(-t,this.parent[t]):this.insDirOf(t,this.parent.parent)}},t.moveLeftWithin=function(t){return this.moveDirWithin(v,t)},t.moveRightWithin=function(t){return this.moveDirWithin(b,t)},t.moveDir=function(t){return i(t),r(this),this.selection?this.insDirOf(t,this.selection.ends[t]).clearSelection():this.moveDirWithin(t,this.root),this.show()},t.moveLeft=function(){return this.moveDir(v)},t.moveRight=function(){return this.moveDir(b)},t.moveUp=function(){return e(this,"up")},t.moveDown=function(){return e(this,"down")},t.seek=function(t,e,n){r(this);var i,s,a=this.clearSelection().show();return t.hasClass("empty")?(a.insAtLeftEnd(y[t.attr(u)]),a):(i=y[t.attr(l)],i instanceof C?(t.outerWidth()>2*(e-t.offset().left)?a.insLeftOf(i):a.insRightOf(i),a):(i||(s=y[t.attr(u)],s||(t=t.parent(),i=y[t.attr(l)],i||(s=y[t.attr(u)],s||(s=a.root)))),i?a.insRightOf(i):a.insAtRightEnd(s),a.seekHoriz(e,a.root)))},t.seekHoriz=function(t,e){var i,r=this,s=n(r).left-t;do r.moveLeftWithin(e),i=s,s=n(r).left-t;while(s>0&&(r[v]||r.parent!==e));return-s>i&&r.moveRightWithin(e),r},t.writeLatex=function(t){var e=this;r(e),e.show().deleteSelection();var n=g.all,i=g.eof,s=ot.skip(i).or(n.result(!1)).parse(t);return s&&(s.children().adopt(e.parent,e[v],e[b]),y.jQize(s.join("html")).insertBefore(e.jQ),e[v]=s.ends[b],s.finalizeInsert(),e.parent.bubble("redraw")),this.hide()},t.write=function(t){var e=this.prepareWrite();return this.insertCh(t,e)},t.insertCh=function(t,e){return this.parent.write(this,t,e),this},t.insertCmd=function(t,e){var n=R[t];return n?(n=n(t),e&&n.replaces(e),n.createLeftOf(this)):(n=Z(),n.replaces(t),n.ends[v].focus=function(){return delete this.focus,this},n.createLeftOf(this),this.insRightOf(n),e&&e.remove()),this},t.unwrapGramp=function(){var t=this.parent.parent,e=t.parent,n=t[b],i=t[v];if(t.disown().eachChild(function(r){r.isEmpty()||(r.children().adopt(e,i,n).each(function(e){e.jQ.insertBefore(t.jQ.first())}),i=r.ends[b])}),!this[b])if(this[v])this[b]=this[v][b];else for(;!this[b];){if(this.parent=this.parent[b],!this.parent){this[b]=t[b],this.parent=e;break}this[b]=this.parent.ends[v]}this[b]?this.insLeftOf(this[b]):this.insAtRightEnd(e),t.jQ.remove(),t[v]&&t[v].respace(),t[b]&&t[b].respace()},t.deleteDir=function(t){if(i(t),r(this),this.show(),this.deleteSelection());else if(this[t])this[t].isEmpty()?this[t]=this[t].remove()[t]:this.selectDir(t);else if(this.parent!==this.root){if(this.parent.parent.isEmpty())return this.insDirOf(-t,this.parent.parent).deleteDir(t);this.unwrapGramp()}return this[v]&&this[v].respace(),this[b]&&this[b].respace(),this.parent.bubble("redraw"),this},t.backspace=function(){return this.deleteDir(v)},t.deleteForward=function(){return this.deleteDir(b)},t.selectFrom=function(t){var e=this,n=t;t:for(;;){for(var i=this;i!==e.parent.parent;i=i.parent.parent)if(i.parent===n.parent){s=i,a=n;break t}for(var r=t;r!==n.parent.parent;r=r.parent.parent)if(e.parent===r.parent){s=e,a=r;break t}e.parent.parent&&(e=e.parent.parent),n.parent.parent&&(n=n.parent.parent)}var s,a,o;if(s[b]!==a){for(var c=s;c;c=c[b])if(c===a[v]){o=!0;break}o||(o=a,a=s,s=o)}this.hide().selection=ht(s[v][b]||s.parent.ends[v],a[b][v]||a.parent.ends[b]),this.insRightOf(a[b][v]||a.parent.ends[b]),this.root.selectionChanged()},t.selectDir=function(t){if(i(t),r(this),this.selection)if(this.selection.ends[t]===this[-t])this[t]?this.hopDir(t).selection.extendDir(t):this.parent!==this.root&&this.insDirOf(t,this.parent.parent).selection.levelUp();else{if(this.hopDir(t),this.selection.ends[t]===this.selection.ends[-t])return void this.clearSelection().show();this.selection.retractDir(t)}else{if(this[t])this.hopDir(t);else{if(this.parent===this.root)return;this.insDirOf(t,this.parent.parent)}this.hide().selection=ht(this[-t])}this.root.selectionChanged()},t.selectLeft=function(){return this.selectDir(v)},t.selectRight=function(){return this.selectDir(b)},t.prepareMove=function(){return r(this),this.show().clearSelection()},t.prepareEdit=function(){return r(this),this.show().deleteSelection()},t.prepareWrite=function(){return r(this),this.show().replaceSelection()},t.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.root.selectionChanged()),this},t.deleteSelection=function(){return!!this.selection&&(this[v]=this.selection.ends[v][v],this[b]=this.selection.ends[b][b],this.selection.remove(),this.root.selectionChanged(),delete this.selection)},t.replaceSelection=function(){var t=this.selection;return t&&(this[v]=t.ends[v][v],this[b]=t.ends[b][b],delete this.selection),t}}),ht=d(L,function(t,e){t.init=function(){var t=this;e.init.apply(t,arguments),t.jQwrap(t.jQ)},t.jQwrap=function(t){this.jQ=t.wrapAll('<span class="selection"></span>').parent()},t.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),e.adopt.apply(this,arguments)},t.clear=function(){return this.jQ.replaceWith(this.jQ.children()),this},t.levelUp=function(){var t=this,e=t.ends[v]=t.ends[b]=t.ends[b].parent.parent;return t.clear().jQwrap(e.jQ),t},t.extendDir=function(t){return i(t),this.ends[t]=this.ends[t][t],this.ends[t].jQ.insAtDirEnd(t,this.jQ),this},t.extendLeft=function(){return this.extendDir(v)},t.extendRight=function(){return this.extendDir(b)},t.retractDir=function(t){i(t),this.ends[-t].jQ.insDirOf(-t,this.jQ),this.ends[-t]=this.ends[-t][t]},t.retractRight=function(){return this.retractDir(b)},t.retractLeft=function(){return this.retractDir(v)}});h.fn.mathquill=function(t,e){switch(t){case"redraw":return this.each(function(){var t=w(this).attr(u),e=t&&y[t];e&&!function t(e){e.eachChild(t),e.redraw&&e.redraw()}(e)});case"revert":return this.each(function(){var t=w(this).attr(u),e=t&&y[t];e&&e.revert&&e.revert()});case"latex":if(arguments.length>1)return this.each(function(){var t=w(this).attr(u),n=t&&y[t];n&&n.renderLatex(e)});var n=w(this).attr(u),i=n&&y[n];return i&&i.latex();case"text":var n=w(this).attr(u),i=n&&y[n];return i&&i.text();case"html":return this.html().replace(/ ?hasCursor|hasCursor /,"").replace(/ class=(""|(?= |>))/g,"").replace(/<span class="?cursor( blink)?"?><\/span>/i,"").replace(/<span class="?textarea"?><textarea><\/textarea><\/span>/i,"");case"write":if(arguments.length>1)return this.each(function(){var t=w(this).attr(u),n=t&&y[t],i=n&&n.cursor;i&&i.writeLatex(e).parent.blur()});case"cmd":if(arguments.length>1)return this.each(function(){var t=w(this).attr(u),n=t&&y[t],i=n&&n.cursor;if(i){var r=i.prepareWrite();/^\\[a-z]+$/i.test(e)?i.insertCmd(e.slice(1),r):i.insertCh(e,r),i.hide().parent.blur()}});default:var s="textbox"===t,a=s||"editable"===t,o=s?E:D;return this.each(function(){r(w(this),o(),s,a)})}},h(function(){h(".mathquill-editable:not(.mathquill-rendered-math)").mathquill("editable"),h(".mathquill-textbox:not(.mathquill-rendered-math)").mathquill("textbox"),h(".mathquill-embedded-latex").mathquill()})}();